---
layout: post
title: Запросы к Github API из Angular
tags: [angular, github]
---
Компания Twitter активно выкладывает свои разрабтки в сеть и это не может не радовать. Ведь все любят [Bootstrap](http://twitter.github.io/bootstrap/) и [Bower](http://bower.io/)? Но на этом классные штуки не кончаются, и все посмотреть можно на странице [Twitter ♥ Open Source](http://twitter.github.io/). Очень странно, что никто больше так не сделал, ведь что может быть прекраснее, чем автоматически составляемый список опубликованных проектов, оформленный в собственном стиле? Именно поэтому я захотел себе такое же автообновляемое портфолио.

В Twitter этот список строится крайне очевидным путем на jQuery без каких-либо дополнительных библиотек. Но такой подход - это не путь для настоящего джедая. Для того чтобы забрать данные с сервера и оформить их в html есть инструменты в каждом frontend - фреймоворке. Мой любимый, а в последнее время и не только мой, - это [angular.js](http://angularjs.org/), поэтому на нем и напишем. Angular &mdash; это MVC фреймворк со своим шаблонизатором, связыванием данных и представления через dirty-check, и множеством отдельных компонентов для облегчения нелегких будней веб-разработки. Эти компоненты помогут нам сделать задачу легко и быстро.

Путь решения нашей задачи будет такой:

1. Запрашиваем через [GitHub API](http://developer.github.com/v3/repos/#list-user-repositories) и список моих репозиториев
2. Результат сохраним в модель 
3. А в представлении опишем шаблон вывода нашего списка

После преобразования этого алгоритма в javascript, мы получим код нашего контроллера:
{% highlight javascript %}
angular.module('homeApp', []).controller('repoController', function($scope, $http) {
	//загружаем список и кладем его в scope
	$http.get('https://api.github.com/users/just-boris/repos')
	.then(function(response) {
		$scope.repos = response.data
	});
	//функция для проверки наличия страницы в репозитории
	$scope.hasHomepage = function(repo) {
		return repo.homepage !== null && repo.homepage !== "";
	}
});
{% endhighlight %}
Контроллер &mdash; это функция, вызываемая при инициализации шаблона, которая определяет начальные условия и логику.
Какого-то особого интерактива в этом примере нет, поэтому и код получился небольшим. Следующая задача &mdash; описать шаблон, используя возможности расширения стандартного html, которые нам дарит angular:

{% highlight html %}
<!-- любые действия в angular начинаются с контроллера, вот и он -->
<div ng-controller="repoController" class="container">
	<h3>Hello! There are my repositories:</h3>
	<!-- здесь запускается итератор по списку, этот узел 
	     будет клонироваться вместе с содержимым -->
	<div class="row" ng-repeat="repo in repos">
		<h5>
			<!-- а здесь ветвление, название оформляется ссылкой, если она есть -->
			<ng-switch on="hasHomepage(repo)">
				<a ng-switch-when="true" ng-href="/{{repo.name}}">{{repo.name}}</a>
				<span ng-switch-when="false">{{repo.name}}</span>
			</ng-switch>
			<small>(<a href="{{repo.html_url}}">repo</a>)</small>
		</h5>
		<p class="muted">
			<!-- это условие проще, его можно оформить в виде show/hide -->
			<img ng-show="repo.fork" src="img/fork.png" 
				class="fork icon" title="Forked repository"/>
		 	{{repo.description}}
	 	</p>
	</div>
</div>
{% endhighlight %}

[Демо-страница](/)

Ну вот и получилось, что основную работу за нас выполнил сам фреймворк. Нам не пришлось изобретать велосипеды, нужно было лишь описать, как разные компоненты должны взаимодействоваить между собой. С версткой тоже проблем не возникло, все достаточно просто описывается, можно легко двигать элементы, потому что при таком подходе не нужны долгие путешествия по DOM, вместо этого каждая его часть делает только одну свою задачу, но делает ее хорошо.

Такую же страницу можно сделать было и на каком-нибудь другом фрейморке, но там бы это выглядело немножко иначе.
Например есть версия такой же странице на фреймворке [BasisJS](http://basisjs.com). [Посмотрите](http://catatron.com/ru/), стиль написания похож на Backbone. 

Получилось очень интересное упражнение, потому что идея построения такого списка на js &mdash; неплохой тест-драйв для любой frontend-библиотеки, вроде написания [TodoMVC](http://todomvc.com/), он позволяет найти слабости и разобраться в основах использования новой неведомой штуки.

**Bonus.** А вы знали, что случится, если нажать на лого Twitter на их [демо-странице](http://twitter.github.io/)?