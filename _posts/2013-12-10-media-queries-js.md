---
layout: post
title: Media query из javascript
tags: [css, bootstrap]
---
Twitter Bootstrap отлично работает с отзывчивым дизайном имеет много впомогательных штук для разметки страницы в зависимости от размера экрана. В частности, есть специальные удобные классы для управления блоками на разных размерах экрана. Подробнее об этом расказанно в [документации](http://getbootstrap.com/css/#responsive-utilities). Однако, если начать пользоваться этими классами на практике, то возникает необходимость узнать через javascript, какие блоки сейчас видны на странице, а какие &mdash; нет. Таким образом, можно не грузить по ajax контент для невидимых блоков или запустить анимацию только для видимых блоков. Ну и совсем здорово будет, если соответствующие эффекты включатся как только изменятся размеры экрана, без перезагрузки. Именно так работают CSS Media Queries и это делает их такими крутыми.

При поиске по интернету в основном встречается [классический вариант](http://www.quirksmode.org/blog/archives/2010/08/combining_media.html) &mdash; проверить свойство `clientWidth` у `document.documentElement`. [Есть вариант получше](http://www.sitepoint.com/javascript-media-queries/), использовать специальную функцию `window.matchMedia` (IE10+):

{% highlight javascript %}
if window.matchMedia( "(min-width: 500px)" ) {
	//наш экран достаточно широк, загружаем данные
}	
{% endhighlight %}
Такой подход прост и удобен, но при использовании Bootstrap можно сделать еще лучше.

В Bootstrap все экраны делятся на 4 типа: большие (**lg**), нормальные (**md**), маленькие (**sm**) и мобильные (**xs**). Точные границы каждой категории обозначены в [таблице в документации](http://getbootstrap.com/css/#responsive-utilities). С помощью специальных классов можно скрывать и показывать блоки только на определенных размерах экрана. Чтобы наши скрипты работали правильно, нужно их тоже привязать к определенному типу экрана (или к нескольким сразу). Но нельзя просто так взять и узнать, на какой ширине видно элемент с классом `visible-md`. Для этого нужно посмотреть в css и скопировать себе этот медиазапрос. А копирование это всегда плохо, вдруг в следующей версии Bootstrap разработчики решат изменить граничне значение для **md** с 992 до 1000px по каким-то своим причинам. Ваш код к такому повороту будет не готов и иногда будет работать неправильно. Поэтому лучше исходить из *фактической* видимости каких-то блоков, которая определяется css. А чтобы каждый блок не следил за размером экрана сам, можно подписать их через отдельную функцию, которую можно взять [из этого скрипта](/assets/media-query-js/registerOnSize.js). Подписка будет выглядеть так:

{% highlight javascript %}
registerOnSize('md', function() {
	//экран нужного нам размера, пора браться за дело!
});
{% endhighlight %}

Ну а функция скрипт сам определит размеры экрана, вызвовет нужные функции и продолжит следить за размерами окна, чтобы вызвать обработчики для новых размеров. Все здорово работает, а главное никакого упоминания конкрентых величин, только имена классов из Bootstrap. Если же на проекте не используется Bootstrap, то можно обойтись и нативным `matchMedia` или продвинутой библиотекой [enquire.js] которая также позволяет регистрировать обработчики на медиазапросы и много чего еще.

На специальной странице показан пример скрипта в действии, вслед за изменениями размеров окна изменяется содержимое, в том числе и текст. В принципе, всю логику этой страницы можно было реализовать исключительно на css, но иногда так не выходит и тогда этот метод &mdash; ваш выбор.

<a class="watch-demo" href="{{site.baseurl}}/assets/media-query-js/">Демо страница</a>

[enquire.js]: https://github.com/WickyNilliams/enquire.js